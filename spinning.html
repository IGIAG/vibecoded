<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spinning Text</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #111;
      perspective: 800px; /* Enable 3D perspective */
      /* Stretch the background image to fill the viewport regardless of aspect ratio */
      background-size: 100% 100%;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* Dark overlay that covers the whole viewport */
    .bg-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5); /* darker background */
      pointer-events: none;
      z-index: 0;
    }

    /* Wrapper that handles the up‑and‑down bobbing */
    .bob {
      animation: bob 2s ease-in-out infinite;
      position: relative; /* for proper stacking */
      z-index: 1;
    }

    .spinner {
      font-size: 15vw;          /* Huge text, responsive */
      font-weight: bold;
      color: #fff;
      animation: spinY 5s linear infinite;
      transform-style: preserve-3d;
    }

    @keyframes spinY {
      from {
        transform: rotateY(0deg);
      }
      to {
        transform: rotateY(360deg);
      }
    }

    @keyframes bob {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-30px);
      }
    }

    /* Container for dynamic ads */
    #ads-container {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .ad-iframe {
      position: absolute;
      width: 300px;
      height: 250px;
      border: none;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <div class="bob">
    <div class="spinner">fih.</div>
  </div>
  <div class="bg-overlay"></div>

  <!-- Dynamic ads will be injected here -->
  <div id="ads-container"></div>

  <script>
    // Configuration for ad spawning
    const AD_INTERVAL_MS = 15000; // every 15 seconds
    const AD_WIDTH = 300;
    const AD_HEIGHT = 250;

    const adsContainer = document.getElementById('ads-container');

    function createAd() {
      const iframe = document.createElement('iframe');
      iframe.src = 'ad.html';
      iframe.className = 'ad-iframe';
      const maxLeft = window.innerWidth - AD_WIDTH;
      const maxTop = window.innerHeight - AD_HEIGHT;
      const left = Math.random() * maxLeft;
      const top = Math.random() * maxTop;
      iframe.style.left = `${left}px`;
      iframe.style.top = `${top}px`;
      adsContainer.appendChild(iframe);
    }

    // Initial ad
    createAd();
    // Subsequent ads
    setInterval(createAd, AD_INTERVAL_MS);
  </script>

  <script>
    // Helper to fetch a random GIF from Tenor based on a query.
    async function setBackgroundGif(searchTerm) {
      const apiKey = 'LIVDSRZULELA'; // Public demo key from Tenor
      const limit = 20;
      const url = `https://g.tenor.com/v1/search?q=${encodeURIComponent(searchTerm)}&key=${apiKey}&limit=${limit}`;

      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();

        if (!data.results || data.results.length === 0) {
          console.warn('No GIFs found for query:', searchTerm);
          return;
        }

        // Pick a random result
        const randomIndex = Math.floor(Math.random() * data.results.length);
        const gif = data.results[randomIndex];

        // Prefer mediumgif, fallback to gif
        const media = gif.media[0];
        const gifUrl = (media && media.mediumgif && media.mediumgif.url) ||
                       (media && media.gif && media.gif.url) ||
                       null;

        if (gifUrl) {
          document.body.style.backgroundImage = `url("${gifUrl}")`;
        }
      } catch (err) {
        console.error('Failed to fetch GIF:', err);
      }
    }

    (function() {
      const params = new URLSearchParams(window.location.search);
      const customText = params.get('text');

      // Update spinner text if provided
      if (customText !== null) {
        const spinner = document.querySelector('.spinner');
        if (spinner) {
          spinner.textContent = decodeURIComponent(customText);
        }
      }

      // Build the search term: user text + "shitpost"
      const baseTerm = customText ? decodeURIComponent(customText) : '';
      const searchTerm = `${baseTerm} shitpost`.trim();

      // Only attempt to fetch a GIF if we have something to search for
      if (searchTerm) {
        setBackgroundGif(searchTerm);
      }
    })();
  </script>
</body>
</html>
